var api=function(){var o;return{cancelVote:function(e,t){var n={tip:e,cancel:1};n[t]=1,$.get(o+"vote",n).done(function(){console.log("Request success")}).fail(function(){console.log("Request fail")})},voteTipUp:function(e){$.get(o+"vote",{tip:e,up:1}).done(function(){console.log("Request success")}).fail(function(){console.log("Request fail")})},voteTipDown:function(e){$.get(o+"vote",{tip:e,down:1}).done(function(){console.log("Request success")}).fail(function(){console.log("Request fail")})},ROOT:o=window.location.hostname.startsWith("pbcs.us")?"/~abeagle/projects/wdwtips/api/":"/projects/capstone/wdwtips/api/"}}();!function(){function e(){var e=document.querySelector("body>header").offsetHeight,t=document.querySelector("nav.topics").offsetHeight,n=document.querySelector("body>footer").offsetHeight,o=document.querySelector(".content-wrapper"),a=window.innerHeight;o.style["min-height"]=a-(e+n+t)-20+"px"}var n,o,a,i;e(),window.addEventListener("resize",(n=e,o=100,function(){var e=this,t=arguments;clearTimeout(i),i=setTimeout(function(){i=null,a||n.apply(e,t)},o),a&&!i&&n.apply(e,t)}))}();var MaxlenWidget=function(e,t,n,o,a){var i,c,l;function s(){c=i.val().length,l.html("("+c+" / "+t+")"),t<c?(l.removeClass(n),l.addClass(o)):(l.removeClass(o),l.addClass(n))}void 0!==e?(void 0===n&&(n="length-valid"),void 0===o&&(o="length-invalid"),void 0===a&&(a="#maxlen-widget"),i=$(e),l=$(a),void 0===t&&(t=i.attr("maxlength")),i.length&&(s(),i.on("input",s))):console.log("ERROR: no inputSelector provided to MaxlenWidget")};new MaxlenWidget('.submit-tip input[name="title"]'),new MaxlenWidget('.create-account input[name="username"]'),function(){function i(){var a=$(this);a.nextAll().remove(),a.after(" "),$("option:selected",a).text()?$.get(api.ROOT+"topics",{topic:a.val()}).done(function(e){var t,n,o;t=e.subtopics,n=a,o=$('<select class="topics"><option value="'+n.val()+'"></option></select>'),t.forEach(function(e){$("<option/>",{val:n.val()+"+"+e.slug,text:e.name[0]}).appendTo(o)}),0<t.length&&(o.change(i),o.appendTo(n.parent()),n.removeAttr("name"),o.attr("name","topic"))}).fail(function(){console.log("Request fail")}):a.attr("name","topic")}$(".submit-tip select.topics").change(i)}(),function(){var t=/^[a-z0-9-]$/i,a=new Set,i=$("form.tip .invalid-key-msg"),c=$("form.tip input.add-tag"),l=$("<button />",{class:"remove",html:"&#x2716;"});function s(e){return e.replace(/[^a-z0-9-]/gi,"").toLowerCase()}function e(e){e.preventDefault(),$(this).parent().remove()}l.attr("aria-label","Remove tag"),l.click(e),$("form.tip button.remove").click(e),c.keypress(function(e){"Enter"==e.key?(e.preventDefault(),$("form.tip button.add-tag").click()):t.test(e.key)?i.fadeOut(250):(e.preventDefault(),i.fadeIn(250))}),$("form.tip button.add-tag").click(function(e){var t,n,o=s(c.val());e.preventDefault(),o&&(10==$("a.btn.tag").length?$(".max-tags").css("font-weight","bold"):a.has(o)||(t=s(o),(n=$("<a/>",{text:t,class:"btn tag"})).append(l.clone(!0)),a.add(t),i.fadeOut(400),$("form.tip .added-tags").append(n),c.val("")))}),$('form.tip button[name="submit"]').click(function(e){values=[],$("a.btn.tag").each(function(e,t){values.push(t.childNodes[0].nodeValue.trim())}),$('input[name="tags"]').val(values.join("+"))}),0<$("form.tip").length&&$.get(api.ROOT+"tags").done(function(e){$("input.add-tag").autocomplete({source:e.tags})}).fail(function(){console.log("Request fail")})}(),function(){var e=document.querySelectorAll(".vote-up .vote-btn"),t=document.querySelectorAll(".vote-down .vote-btn");function a(e){var t=e.querySelector(".score"),n=e.querySelector(".vote-up .vote-btn");n.classList.contains("voted")&&(api.cancelVote(n.dataset.id,"down"),t.innerHTML=parseInt(t.innerHTML)-1,n.classList.remove("voted"))}function i(e){var t=e.querySelector(".score"),n=e.querySelector(".vote-down .vote-btn");n.classList.contains("voted")&&(api.cancelVote(n.dataset.id,"up"),t.innerHTML=parseInt(t.innerHTML)+1,n.classList.remove("voted"))}e.forEach(function(o){o.addEventListener("click",function(e){var t,n;o.classList.contains("voted")?a(o.parentElement.parentElement):(n=(t=o).parentElement.parentElement.querySelector(".score"),api.voteTipUp(t.dataset.id),t.classList.add("voted"),i(t.parentElement.parentElement),n.innerHTML=parseInt(n.innerHTML)+1)})}),t.forEach(function(o){o.addEventListener("click",function(e){var t,n;o.classList.contains("voted")?i(o.parentElement.parentElement):(n=(t=o).parentElement.parentElement.querySelector(".score"),a(t.parentElement.parentElement),api.voteTipDown(t.dataset.id),t.classList.add("voted"),n.innerHTML=parseInt(n.innerHTML)-1)})}),$(".tip-control.delete").on("click",function(e){1==e.which&&(confirm("Are you sure you want to delete this tip?")||e.preventDefault())})}();